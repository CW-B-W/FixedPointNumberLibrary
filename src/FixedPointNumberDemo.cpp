#include <iostream>
#include <vector>
#include <cstdint>
#include "FixedPointNumber.hpp"

using namespace std;

extern uint32_t H[32];
extern uint32_t X[1024];

template <typename T1, typename T2>
vector<T1> convolution(vector<T1> x, vector<T2> h) {
    vector<T1> y;
    for (int i = h.size()-1; i < x.size()+h.size()-1; ++i) {
        T1 yi = 0;
        for (int k = 0; k < h.size(); ++k) {
            if (i-k < x.size()) {
                yi = yi + x[i-k] * h[k];
            }
        }
        y.emplace_back(yi);
    }
    return y;
}

int main()
{
    vector<FixedPointNumber<7, 8>> x_vec;
    vector<FixedPointNumber<3, 16>> h_vec;
    for (int i = 0; i < 256; ++i) {
        x_vec.emplace_back(X[i]);
    }
    for (int i = 0; i < 32; ++i) {
        h_vec.emplace_back(H[i]);
    }
    vector<FixedPointNumber<7, 8>> y_vec = convolution(x_vec, h_vec);

    for (int i = 0; i < 128; ++i) {
        cout << i << ' ' << y_vec[i] << ' ' << y_vec[i].to_double() << endl;
    }

    return 0;
}

/* 1bit sign, 3bits int, 16bits frac */
uint32_t H[32] = {
    0xFFF9E,
    0xFFF86,
    0xFFFA7,
    0x0003B,
    0x0015B,
    0x0024A,
    0x00222,
    0xFFFE4,
    0xFFBC5,
    0xFF7CA,
    0xFF74E,
    0xFFD74,
    0x00B1A,
    0x01DAC,
    0x02F9E,
    0x03AA9,
    0x03AA9,
    0x02F9E,
    0x01DAC,
    0x00B1A,
    0xFFD74,
    0xFF74E,
    0xFF7CA,
    0xFFBC5,
    0xFFFE4,
    0x00222,
    0x0024A,
    0x0015B,
    0x0003B,
    0xFFFA7,
    0xFFF86,
    0xFFF9E
};

/* 1bit sign, 7bits int, 8bits frac */
uint32_t X[1024] = {
    0x0067,
    0x00BD,
    0x00F3,
    0x00FE,
    0x00DE,
    0x0098,
    0x0038,
    0xFFCF,
    0xFF6D,
    0xFF25,
    0xFF02,
    0xFF0C,
    0xFF3F,
    0xFF93,
    0xFFFA,
    0x0061,
    0x00B9,
    0x00F1,
    0x00FF,
    0x00E1,
    0x009D,
    0x003E,
    0xFFD5,
    0xFF72,
    0xFF28,
    0xFF03,
    0xFF0A,
    0xFF3B,
    0xFF8D,
    0xFFF4,
    0x005C,
    0x00B5,
    0x00EE,
    0x00FF,
    0x00E4,
    0x00A2,
    0x0044,
    0xFFDB,
    0xFF78,
    0xFF2C,
    0xFF04,
    0xFF08,
    0xFF37,
    0xFF88,
    0xFFEE,
    0x0056,
    0x00B0,
    0x00EC,
    0x00FF,
    0x00E7,
    0x00A7,
    0x004A,
    0xFFE1,
    0xFF7D,
    0xFF2F,
    0xFF05,
    0xFF07,
    0xFF33,
    0xFF82,
    0xFFE7,
    0x0050,
    0x00AB,
    0x00EA,
    0x0100,
    0x00EA,
    0x00AB,
    0x0050,
    0xFFE7,
    0xFF82,
    0xFF33,
    0xFF07,
    0xFF05,
    0xFF2F,
    0xFF7D,
    0xFFE1,
    0x004A,
    0x00A7,
    0x00E7,
    0x00FF,
    0x00EC,
    0x00B0,
    0x0056,
    0xFFEE,
    0xFF88,
    0xFF37,
    0xFF08,
    0xFF04,
    0xFF2C,
    0xFF78,
    0xFFDB,
    0x0044,
    0x00A2,
    0x00E4,
    0x00FF,
    0x00EE,
    0x00B5,
    0x005C,
    0xFFF4,
    0xFF8D,
    0xFF3B,
    0xFF0A,
    0xFF03,
    0xFF28,
    0xFF72,
    0xFFD5,
    0x003E,
    0x009D,
    0x00E1,
    0x00FF,
    0x00F1,
    0x00B9,
    0x0061,
    0xFFFA,
    0xFF93,
    0xFF3F,
    0xFF0C,
    0xFF02,
    0xFF25,
    0xFF6D,
    0xFFCF,
    0x0038,
    0x0098,
    0x00DE,
    0x00FE,
    0x00F3,
    0x00BD,
    0x0067,
    0x0000,
    0xFF99,
    0xFF43,
    0xFF0D,
    0xFF02,
    0xFF22,
    0xFF68,
    0xFFC8,
    0x0031,
    0x0093,
    0x00DB,
    0x00FE,
    0x00F4,
    0x00C1,
    0x006D,
    0x0006,
    0xFF9F,
    0xFF47,
    0xFF0F,
    0xFF01,
    0xFF1F,
    0xFF63,
    0xFFC2,
    0x002B,
    0x008E,
    0x00D8,
    0x00FD,
    0x00F6,
    0x00C5,
    0x0073,
    0x000C,
    0xFFA4,
    0xFF4B,
    0xFF12,
    0xFF01,
    0xFF1C,
    0xFF5E,
    0xFFBC,
    0x0025,
    0x0088,
    0x00D4,
    0x00FC,
    0x00F8,
    0x00C9,
    0x0078,
    0x0012,
    0xFFAA,
    0xFF50,
    0xFF15,
    0xFF01,
    0xFF19,
    0xFF59,
    0xFFB6,
    0x001F,
    0x0083,
    0x00D1,
    0x00FB,
    0x00F9,
    0x00CD,
    0x007E,
    0x0019,
    0xFFB0,
    0xFF55,
    0xFF16,
    0xFF00,
    0xFF16,
    0xFF55,
    0xFFB0,
    0x0019,
    0x007E,
    0x00CD,
    0x00F9,
    0x00FB,
    0x00D1,
    0x0083,
    0x001F,
    0xFFB6,
    0xFF59,
    0xFF19,
    0xFF01,
    0xFF15,
    0xFF50,
    0xFFAA,
    0x0012,
    0x0078,
    0x00C9,
    0x00F8,
    0x00FC,
    0x00D4,
    0x0088,
    0x0025,
    0xFFBC,
    0xFF5E,
    0xFF1C,
    0xFF01,
    0xFF12,
    0xFF4B,
    0xFFA4,
    0x000C,
    0x0073,
    0x00C5,
    0x00F6,
    0x00FD,
    0x00D8,
    0x008E,
    0x002B,
    0xFFC2,
    0xFF63,
    0xFF1F,
    0xFF01,
    0xFF0F,
    0xFF47,
    0xFF9F,
    0x0006,
    0x006D,
    0x00C1,
    0x00F4,
    0x00FE,
    0x00DB,
    0x0093,
    0x0031,
    0xFFC8,
    0xFF68,
    0xFF22,
    0xFF02,
    0xFF0D,
    0xFF43,
    0xFF99,
    0x0000,
    0x0067,
    0x00BD,
    0x00F3,
    0x00FE,
    0x00DE,
    0x0098,
    0x0038,
    0xFFCF,
    0xFF6D,
    0xFF25,
    0xFF02,
    0xFF0C,
    0xFF3F,
    0xFF93,
    0xFFFA,
    0x0061,
    0x00B9,
    0x00F1,
    0x00FF,
    0x00E1,
    0x009D,
    0x003E,
    0xFFD5,
    0xFF72,
    0xFF28,
    0xFF03,
    0xFF0A,
    0xFF3B,
    0xFF8D,
    0xFFF4,
    0x005C,
    0x00B5,
    0x00EE,
    0x00FF,
    0x00E4,
    0x00A2,
    0x0044,
    0xFFDB,
    0xFF78,
    0xFF2C,
    0xFF04,
    0xFF08,
    0xFF37,
    0xFF88,
    0xFFEE,
    0x0056,
    0x00B0,
    0x00EC,
    0x00FF,
    0x00E7,
    0x00A7,
    0x004A,
    0xFFE1,
    0xFF7D,
    0xFF2F,
    0xFF05,
    0xFF07,
    0xFF33,
    0xFF82,
    0xFFE7,
    0x0050,
    0x00AB,
    0x00EA,
    0x0100,
    0x00EA,
    0x00AB,
    0x0050,
    0xFFE7,
    0xFF82,
    0xFF33,
    0xFF07,
    0xFF05,
    0xFF2F,
    0xFF7D,
    0xFFE1,
    0x004A,
    0x00A7,
    0x00E7,
    0x00FF,
    0x00EC,
    0x00B0,
    0x0056,
    0xFFEE,
    0xFF88,
    0xFF37,
    0xFF08,
    0xFF04,
    0xFF2C,
    0xFF78,
    0xFFDB,
    0x0044,
    0x00A2,
    0x00E4,
    0x00FF,
    0x00EE,
    0x00B5,
    0x005C,
    0xFFF4,
    0xFF8D,
    0xFF3B,
    0xFF0A,
    0xFF03,
    0xFF28,
    0xFF72,
    0xFFD5,
    0x003E,
    0x009D,
    0x00E1,
    0x00FF,
    0x00F1,
    0x00B9,
    0x0061,
    0xFFFA,
    0xFF93,
    0xFF3F,
    0xFF0C,
    0xFF02,
    0xFF25,
    0xFF6D,
    0xFFCF,
    0x0038,
    0x0098,
    0x00DE,
    0x00FE,
    0x00F3,
    0x00BD,
    0x0067,
    0x0000,
    0xFF99,
    0xFF43,
    0xFF0D,
    0xFF02,
    0xFF22,
    0xFF68,
    0xFFC8,
    0x0031,
    0x0093,
    0x00DB,
    0x00FE,
    0x00F4,
    0x00C1,
    0x006D,
    0x0006,
    0xFF9F,
    0xFF47,
    0xFF0F,
    0xFF01,
    0xFF1F,
    0xFF63,
    0xFFC2,
    0x002B,
    0x008E,
    0x00D8,
    0x00FD,
    0x00F6,
    0x00C5,
    0x0073,
    0x000C,
    0xFFA4,
    0xFF4B,
    0xFF12,
    0xFF01,
    0xFF1C,
    0xFF5E,
    0xFFBC,
    0x0025,
    0x0088,
    0x00D4,
    0x00FC,
    0x00F8,
    0x00C9,
    0x0078,
    0x0012,
    0xFFAA,
    0xFF50,
    0xFF15,
    0xFF01,
    0xFF19,
    0xFF59,
    0xFFB6,
    0x001F,
    0x0083,
    0x00D1,
    0x00FB,
    0x00F9,
    0x00CD,
    0x007E,
    0x0019,
    0xFFB0,
    0xFF55,
    0xFF16,
    0xFF00,
    0xFF16,
    0xFF55,
    0xFFB0,
    0x0019,
    0x007E,
    0x00CD,
    0x00F9,
    0x00FB,
    0x00D1,
    0x0083,
    0x001F,
    0xFFB6,
    0xFF59,
    0xFF19,
    0xFF01,
    0xFF15,
    0xFF50,
    0xFFAA,
    0x0012,
    0x0078,
    0x00C9,
    0x00F8,
    0x00FC,
    0x00D4,
    0x0088,
    0x0025,
    0xFFBC,
    0xFF5E,
    0xFF1C,
    0xFF01,
    0xFF12,
    0xFF4B,
    0xFFA4,
    0x000C,
    0x0073,
    0x00C5,
    0x00F6,
    0x00FD,
    0x00D8,
    0x008E,
    0x002B,
    0xFFC2,
    0xFF63,
    0xFF1F,
    0xFF01,
    0xFF0F,
    0xFF47,
    0xFF9F,
    0x0006,
    0x006D,
    0x00C1,
    0x00F4,
    0x00FE,
    0x00DB,
    0x0093,
    0x0031,
    0xFFC8,
    0xFF68,
    0xFF22,
    0xFF02,
    0xFF0D,
    0xFF43,
    0xFF99,
    0x0000,
    0x0067,
    0x00BD,
    0x00F3,
    0x00FE,
    0x00DE,
    0x0098,
    0x0038,
    0xFFCF,
    0xFF6D,
    0xFF25,
    0xFF02,
    0xFF0C,
    0xFF3F,
    0xFF93,
    0xFFFA,
    0x0061,
    0x00B9,
    0x00F1,
    0x00FF,
    0x00E1,
    0x009D,
    0x003E,
    0xFFD5,
    0xFF72,
    0xFF28,
    0xFF03,
    0xFF0A,
    0xFF3B,
    0xFF8D,
    0xFFF4,
    0x005C,
    0x00B5,
    0x00EE,
    0x00FF,
    0x00E4,
    0x00A2,
    0x0044,
    0xFFDB,
    0xFF78,
    0xFF2C,
    0xFF04,
    0xFF08,
    0xFF37,
    0xFF88,
    0xFFEE,
    0x0056,
    0x00B0,
    0x00EC,
    0x00FF,
    0x00E7,
    0x00A7,
    0x004A,
    0xFFE1,
    0xFF7D,
    0xFF2F,
    0xFF05,
    0xFF07,
    0xFF33,
    0xFF82,
    0xFFE7,
    0x0050,
    0x00AB,
    0x00EA,
    0x0100,
    0x00EA,
    0x00AB,
    0x0050,
    0xFFE7,
    0xFF82,
    0xFF33,
    0xFF07,
    0xFF05,
    0xFF2F,
    0xFF7D,
    0xFFE1,
    0x004A,
    0x00A7,
    0x00E7,
    0x00FF,
    0x00EC,
    0x00B0,
    0x0056,
    0xFFEE,
    0xFF88,
    0xFF37,
    0xFF08,
    0xFF04,
    0xFF2C,
    0xFF78,
    0xFFDB,
    0x0044,
    0x00A2,
    0x00E4,
    0x00FF,
    0x00EE,
    0x00B5,
    0x005C,
    0xFFF4,
    0xFF8D,
    0xFF3B,
    0xFF0A,
    0xFF03,
    0xFF28,
    0xFF72,
    0xFFD5,
    0x003E,
    0x009D,
    0x00E1,
    0x00FF,
    0x00F1,
    0x00B9,
    0x0061,
    0xFFFA,
    0xFF93,
    0xFF3F,
    0xFF0C,
    0xFF02,
    0xFF25,
    0xFF6D,
    0xFFCF,
    0x0038,
    0x0098,
    0x00DE,
    0x00FE,
    0x00F3,
    0x00BD,
    0x0067,
    0x0000,
    0xFF99,
    0xFF43,
    0xFF0D,
    0xFF02,
    0xFF22,
    0xFF68,
    0xFFC8,
    0x0031,
    0x0093,
    0x00DB,
    0x00FE,
    0x00F4,
    0x00C1,
    0x006D,
    0x0006,
    0xFF9F,
    0xFF47,
    0xFF0F,
    0xFF01,
    0xFF1F,
    0xFF63,
    0xFFC2,
    0x002B,
    0x008E,
    0x00D8,
    0x00FD,
    0x00F6,
    0x00C5,
    0x0073,
    0x000C,
    0xFFA4,
    0xFF4B,
    0xFF12,
    0xFF01,
    0xFF1C,
    0xFF5E,
    0xFFBC,
    0x0025,
    0x0088,
    0x00D4,
    0x00FC,
    0x00F8,
    0x00C9,
    0x0078,
    0x0012,
    0xFFAA,
    0xFF50,
    0xFF15,
    0xFF01,
    0xFF19,
    0xFF59,
    0xFFB6,
    0x001F,
    0x0083,
    0x00D1,
    0x00FB,
    0x00F9,
    0x00CD,
    0x007E,
    0x0019,
    0xFFB0,
    0xFF55,
    0xFF16,
    0xFF00,
    0xFF16,
    0xFF55,
    0xFFB0,
    0x0019,
    0x007E,
    0x00CD,
    0x00F9,
    0x00FB,
    0x00D1,
    0x0083,
    0x001F,
    0xFFB6,
    0xFF59,
    0xFF19,
    0xFF01,
    0xFF15,
    0xFF50,
    0xFFAA,
    0x0012,
    0x0078,
    0x00C9,
    0x00F8,
    0x00FC,
    0x00D4,
    0x0088,
    0x0025,
    0xFFBC,
    0xFF5E,
    0xFF1C,
    0xFF01,
    0xFF12,
    0xFF4B,
    0xFFA4,
    0x000C,
    0x0073,
    0x00C5,
    0x00F6,
    0x00FD,
    0x00D8,
    0x008E,
    0x002B,
    0xFFC2,
    0xFF63,
    0xFF1F,
    0xFF01,
    0xFF0F,
    0xFF47,
    0xFF9F,
    0x0006,
    0x006D,
    0x00C1,
    0x00F4,
    0x00FE,
    0x00DB,
    0x0093,
    0x0031,
    0xFFC8,
    0xFF68,
    0xFF22,
    0xFF02,
    0xFF0D,
    0xFF43,
    0xFF99,
    0x0000,
    0x0067,
    0x00BD,
    0x00F3,
    0x00FE,
    0x00DE,
    0x0098,
    0x0038,
    0xFFCF,
    0xFF6D,
    0xFF25,
    0xFF02,
    0xFF0C,
    0xFF3F,
    0xFF93,
    0xFFFA,
    0x0061,
    0x00B9,
    0x00F1,
    0x00FF,
    0x00E1,
    0x009D,
    0x003E,
    0xFFD5,
    0xFF72,
    0xFF28,
    0xFF03,
    0xFF0A,
    0xFF3B,
    0xFF8D,
    0xFFF4,
    0x005C,
    0x00B5,
    0x00EE,
    0x00FF,
    0x00E4,
    0x00A2,
    0x0044,
    0xFFDB,
    0xFF78,
    0xFF2C,
    0xFF04,
    0xFF08,
    0xFF37,
    0xFF88,
    0xFFEE,
    0x0056,
    0x00B0,
    0x00EC,
    0x00FF,
    0x00E7,
    0x00A7,
    0x004A,
    0xFFE1,
    0xFF7D,
    0xFF2F,
    0xFF05,
    0xFF07,
    0xFF33,
    0xFF82,
    0xFFE7,
    0x0050,
    0x00AB,
    0x00EA,
    0x0100,
    0x00EA,
    0x00AB,
    0x0050,
    0xFFE7,
    0xFF82,
    0xFF33,
    0xFF07,
    0xFF05,
    0xFF2F,
    0xFF7D,
    0xFFE1,
    0x004A,
    0x00A7,
    0x00E7,
    0x00FF,
    0x00EC,
    0x00B0,
    0x0056,
    0xFFEE,
    0xFF88,
    0xFF37,
    0xFF08,
    0xFF04,
    0xFF2C,
    0xFF78,
    0xFFDB,
    0x0044,
    0x00A2,
    0x00E4,
    0x00FF,
    0x00EE,
    0x00B5,
    0x005C,
    0xFFF4,
    0xFF8D,
    0xFF3B,
    0xFF0A,
    0xFF03,
    0xFF28,
    0xFF72,
    0xFFD5,
    0x003E,
    0x009D,
    0x00E1,
    0x00FF,
    0x00F1,
    0x00B9,
    0x0061,
    0xFFFA,
    0xFF93,
    0xFF3F,
    0xFF0C,
    0xFF02,
    0xFF25,
    0xFF6D,
    0xFFCF,
    0x0038,
    0x0098,
    0x00DE,
    0x00FE,
    0x00F3,
    0x00BD,
    0x0067,
    0x0000,
    0xFF99,
    0xFF43,
    0xFF0D,
    0xFF02,
    0xFF22,
    0xFF68,
    0xFFC8,
    0x0031,
    0x0093,
    0x00DB,
    0x00FE,
    0x00F4,
    0x00C1,
    0x006D,
    0x0006,
    0xFF9F,
    0xFF47,
    0xFF0F,
    0xFF01,
    0xFF1F,
    0xFF63,
    0xFFC2,
    0x002B,
    0x008E,
    0x00D8,
    0x00FD,
    0x00F6,
    0x00C5,
    0x0073,
    0x000C,
    0xFFA4,
    0xFF4B,
    0xFF12,
    0xFF01,
    0xFF1C,
    0xFF5E,
    0xFFBC,
    0x0025,
    0x0088,
    0x00D4,
    0x00FC,
    0x00F8,
    0x00C9,
    0x0078,
    0x0012,
    0xFFAA,
    0xFF50,
    0xFF15,
    0xFF01,
    0xFF19,
    0xFF59,
    0xFFB6,
    0x001F,
    0x0083,
    0x00D1,
    0x00FB,
    0x00F9,
    0x00CD,
    0x007E,
    0x0019,
    0xFFB0,
    0xFF55,
    0xFF16,
    0xFF00,
    0xFF16,
    0xFF55,
    0xFFB0,
    0x0019,
    0x007E,
    0x00CD,
    0x00F9,
    0x00FB,
    0x00D1,
    0x0083,
    0x001F,
    0xFFB6,
    0xFF59,
    0xFF19,
    0xFF01,
    0xFF15,
    0xFF50,
    0xFFAA,
    0x0012,
    0x0078,
    0x00C9,
    0x00F8,
    0x00FC,
    0x00D4,
    0x0088,
    0x0025,
    0xFFBC,
    0xFF5E,
    0xFF1C,
    0xFF01,
    0xFF12,
    0xFF4B,
    0xFFA4,
    0x000C,
    0x0073,
    0x00C5,
    0x00F6,
    0x00FD,
    0x00D8,
    0x008E,
    0x002B,
    0xFFC2,
    0xFF63,
    0xFF1F,
    0xFF01,
    0xFF0F,
    0xFF47,
    0xFF9F,
    0x0006,
    0x006D,
    0x00C1,
    0x00F4,
    0x00FE,
    0x00DB,
    0x0093,
    0x0031,
    0xFFC8,
    0xFF68,
    0xFF22,
    0xFF02,
    0xFF0D,
    0xFF43,
    0xFF99,
    0000
};